{% extends 'base.html' %}

{% load static %}

{% block pagetitle %} Map {% endblock %}

{% block main %}
<div id="map"></div>
{% endblock %}

{% block script %}
<script>
  var myLatlng = new google.maps.LatLng(36.0922455, 139.944458);
  var mapOptions = {
    zoom: 2.5,
    center: myLatlng,
    scrollwheel: false, //we disable de scroll over the map, it is a really annoing when you scroll through page
    styles: [{
      "featureType": "water",
      "stylers": [{
        "saturation": 43
      }, {
        "lightness": -11
      }, {
        "hue": "#0088ff"
      }]
    }, {
      "featureType": "road",
      "elementType": "geometry.fill",
      "stylers": [{
        "hue": "#ff0000"
      }, {
        "saturation": -100
      }, {
        "lightness": 99
      }]
    }, {
      "featureType": "road",
      "elementType": "geometry.stroke",
      "stylers": [{
        "color": "#808080"
      }, {
        "lightness": 54
      }]
    }, {
      "featureType": "landscape.man_made",
      "elementType": "geometry.fill",
      "stylers": [{
        "color": "#ece2d9"
      }]
    }, {
      "featureType": "poi.park",
      "elementType": "geometry.fill",
      "stylers": [{
        "color": "#ccdca1"
      }]
    }, {
      "featureType": "road",
      "elementType": "labels.text.fill",
      "stylers": [{
        "color": "#767676"
      }]
    }, {
      "featureType": "road",
      "elementType": "labels.text.stroke",
      "stylers": [{
        "color": "#ffffff"
      }]
    }, {
      "featureType": "poi",
      "stylers": [{
        "visibility": "off"
      }]
    }, {
      "featureType": "landscape.natural",
      "elementType": "geometry.fill",
      "stylers": [{
        "visibility": "on"
      }, {
        "color": "#b8cb93"
      }]
    }, {
      "featureType": "poi.park",
      "stylers": [{
        "visibility": "on"
      }]
    }, {
      "featureType": "poi.sports_complex",
      "stylers": [{
        "visibility": "on"
      }]
    }, {
      "featureType": "poi.medical",
      "stylers": [{
        "visibility": "on"
      }]
    }, {
      "featureType": "poi.business",
      "stylers": [{
        "visibility": "simplified"
      }]
    }]

  }
  var map = new google.maps.Map(document.getElementById("map"), mapOptions);

  // var imagePath = '{{ user.profile.image.url }}';

  var marker;
  var html;
  var infoWindow;

  {% for loc in view.get_locations %}
  marker = new google.maps.Marker({
    position: new google.maps.LatLng({{ loc.latitude }}, {{ loc.longitude }}),
    title: "@{{ loc.user.username }}",
    // animation: google.maps.Animation.BOUNCE
  });

  html = '\{{ loc.user.first_name }} {{ loc.user.last_name }}\
  ';
  infoWindow = new google.maps.InfoWindow({
    // 吹き出しに出す文
    content: html
  });

  infoWindow.open(map, marker);
  // 吹き出しが閉じられたら、マーカークリックで再び開くようにしておく
  // google.maps.event.addListener(infoWindow, "closeclick", function() {
  //   google.maps.event.addListenerOnce(marker, "click", function(event) {
  //     infoWindow.open(map, marker);
  //   });
  // });

  // To add the marker to the map, call setMap();
  marker.setMap(map);
  {% endfor %}
</script>
{% endblock%}